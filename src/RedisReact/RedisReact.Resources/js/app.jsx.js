var Dashboard=React.createClass({displayName:"Dashboard",mixins:[Reflux.listenTo(InfoStore,"onInfoResults")],getInitialState:function(){return{info:InfoStore.info}},onInfoResults:function(e){this.setState({info:e})},render:function(){var e=React.createElement("div",null),t=this.state.info;return t&&(e=React.createElement("table",{className:"table table-striped table-wrap"},[].concat.apply(Object.keys(t).map(function(e){var a=[React.createElement("tr",null,React.createElement("th",{colSpan:"2"},e))],n=t[e];return Object.keys(n).forEach(function(e){a.push(React.createElement("tr",null,React.createElement("td",null,e),React.createElement("td",null,n[e])))}),a})))),React.createElement("div",{id:"dashboard-page"},React.createElement("div",{className:"content"},e))}}),KeyView=React.createClass({displayName:"KeyView",renderValue:function(e){if("undefined"==typeof e&&(e=""),!isJsonObject(e))return"string"==typeof e&&e.startsWith('"')&&e.endsWith('"')&&(e=e.substring(1,e.length-1)),React.createElement("div",null,e);if(this.props.rawMode)return React.createElement("div",{className:"rawview"},e);try{var t=JSON.parse(e),a=React.createElement("div",{className:"jsonviewer",dangerouslySetInnerHTML:{__html:jsonviewer(t)}});return a}catch(n){return React.createElement("div",null,e)}},renderString:function(e){return React.createElement("div",{className:"key-preview key-string wrap"},React.createElement("table",{className:"table table-striped wrap"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,this.renderValue(e))))))},renderList:function(e){var t=this,a=0;return React.createElement("table",{className:"table table-striped wrap"},React.createElement("tbody",null,e.map(function(e){return React.createElement("tr",{key:a++},React.createElement("td",null,t.renderValue(e)))})))},renderMap:function(e){var t=this;return React.createElement("table",{className:"table table-striped wrap"},React.createElement("tbody",null,Object.keys(e).map(function(a){return React.createElement("tr",{key:a},React.createElement("td",null,t.renderValue(a)),React.createElement("td",null,t.renderValue(e[a])))})))},render:function(){var e=React.createElement("div",{className:"keyview-none"},"Key does not exist"),t=this.props.result;if(!t)return e;"string"==t.type?e=this.renderString(t.value):"list"==t.type?e=this.renderList(t.value):"set"==t.type?e=this.renderList(t.value):"zset"==t.type?e=this.renderMap(t.value):"hash"==t.type&&(e=this.renderMap(t.value));var a=React.createElement("b",null,React.createElement(Link,{to:"keys",query:{id:t.id,type:t.type}},t.id));if(this.props.isPrimary){for(var n=t.id,c=[],s=0,r=0;r<n.length;r++){var l=n[r];if(-1!=SEPARATORS.indexOf(l)){var i=n.substring(0,r+1)+"*";c.push(React.createElement(Link,{key:i,to:"search",query:{q:i}},n.substring(s,r))),c.push(React.createElement("em",{key:r},n.substring(r,r+1))),s=r+1}}c.push(React.createElement("b",{key:s},n.substring(s))),a=React.createElement("b",{className:"keycrumbs"},c)}return React.createElement("div",{className:"keyview"},React.createElement("h3",null,React.createElement("span",{className:"octicon octicon-key"}),React.createElement("i",null,t.type),a),React.createElement("div",{onClick:this.props.toggleRawMode,title:"use 't' shortcut key"},e))}}),KeyViewer=React.createClass({displayName:"KeyViewer",mixins:[DebugLogMixin,Router.Navigation,Router.State,Reflux.listenTo(SettingsStore,"onSettingsUpdated"),Reflux.listenTo(KeyStore,"onKeyLoaded")],componentWillMount:function(){this.setState({appRawMode:SettingsStore.appRawMode,rawModes:{},relatedKeys:[]});var e=this.getQuery();Actions.loadKey(e.id,e.type),document.addEventListener("keyup",this.globalKeyUp)},componentWillUnmount:function(){document.removeEventListener("keyup",this.globalKeyUp)},componentWillReceiveProps:function(){var e=this.getQuery();Actions.loadKey(e.id,e.type)},onSettingsUpdated:function(e){this.setState({appRawMode:e.appRawMode,rawModes:{}})},onKeyLoaded:function(e){this.setState({result:e})},navToKey:function(e){var t=$(e.target).parents("tr");this.viewKey(t.data("id"),t.data("type"))},viewKey:function(e,t){var a={id:e,type:t};this.transitionTo("keys",null,a)},console:function(){this.transitionTo("console"),Actions.setConsole("GET "+this.state.result.id)},edit:function(){this.transitionTo("console",null,{expand:!0}),Actions.setConsole("SET "+this.state.result.id+" "+this.state.result.value)},del:function(){this.transitionTo("console"),Actions.setConsole("DEL "+this.state.result.id)},delAll:function(){this.transitionTo("console");var e="DEL "+this.state.result.id,t=this.state.result.relatedKeys||{};Object.keys(t).forEach(function(a){t[a]&&(e+=" "+a)}),Actions.setConsole(e)},toggleRawMode:function(e,t){if(!hasTextSelected()){if(this.state.rawModes[e]&&(t.shiftKey||t.ctrlKey))return void selectText(t.target);this.state.rawModes[e]=!this.state.rawModes[e],this.setState({rawModes:this.state.rawModes})}},globalKeyUp:function(e){var t=[Keys.LEFT,Keys.RIGHT];if(!e.altKey&&!e.ctrlKey&&-1!=t.indexOf(e.which))for(var a=e.which==Keys.LEFT?-1:1,n=this.getQuery().id,c=this.state.result.similarKeys||[],s=0;s<c.length;s++){var r=c[s];if(r.id==n){var l=c[s+a];return void(l&&this.viewKey(l.id,l.type))}}},render:function(){var e=this,t=(React.createElement("div",null,"Key does not exist"),React.createElement("div",null)),a=this.state.result;a&&a.similarKeys&&(t=React.createElement("table",{className:"table"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,a.query)),a.similarKeys.map(function(t){var n=t.id==a.id?"active ":"",c=n?React.createElement("b",{className:"octicon octicon-chevron-right"}):React.createElement("b",null);return React.createElement("tr",{key:t.id,className:n,onClick:e.navToKey,"data-id":t.id,"data-type":t.type},React.createElement("td",null,c,t.id))}))));var n=a&&a.relatedKeys||{},c=this.getQuery().id,s=this.state.rawModes,r=0,l=null;a&&"string"==a.type&&(l=React.createElement("div",{className:"action",onClick:this.edit},React.createElement("span",{className:"octicon octicon-pencil"}),React.createElement("b",null,"edit")));var i=null;return Object.keys(n).length>0&&(i=React.createElement("div",{className:"action",onClick:this.delAll},React.createElement("span",{className:"octicon octicon-x"}),React.createElement("b",null,"all"))),React.createElement("div",{id:"keyviewer-page"},React.createElement("div",{className:"actions"},React.createElement("div",{className:"action",onClick:this.console},React.createElement("span",{className:"octicon octicon-terminal"}),React.createElement("b",null,"console")),l,React.createElement("div",{className:"action",onClick:this.del},React.createElement("span",{className:"octicon octicon-x"}),React.createElement("b",null,"delete")),i),React.createElement("div",{className:"content"},React.createElement("div",{id:"similarkeys",title:"use left/right arrow keys"},t),React.createElement("div",{id:"keyview"},React.createElement(KeyView,{key:c,result:a,rawMode:this.state.appRawMode?!s[r]:s[r],toggleRawMode:this.toggleRawMode.bind(this,r),isPrimary:!0}),Object.keys(n).map(function(t){if(n[t]){r++;var a={id:t,value:n[t],type:"string"};return React.createElement(KeyView,{key:t,result:a,rawMode:e.state.appRawMode?!s[r]:s[r],toggleRawMode:e.toggleRawMode.bind(e,r)})}}))))}}),Search=React.createClass({displayName:"Search",mixins:[DebugLogMixin,Router.Navigation,Router.State,Reflux.listenTo(SearchStore,"onSearchResults")],getInitialState:function(){return{query:SearchStore.query,results:SearchStore.results,viewGrid:!1,gridResults:[]}},componentWillMount:function(){var e=this.getQuery().q;Actions.search(e)},componentWillReceiveProps:function(){var e=this.getQuery().q;Actions.search(e)},onSearchResults:function(e){this.setState({query:e.query,results:e.results,viewGrid:!1,gridResults:[]})},onKeyClick:function(e){var t=$(e.target).parent("tr");this.transitionTo("keys",null,{id:t.data("id"),type:t.data("type")})},toggleGridView:function(){var e=!this.state.viewGrid,t=this.state.results.map(function(e){return e.id}),a=this;Redis.getStringValues(t).then(function(t){var n=[];Object.keys(t).forEach(function(e){try{var a=JSON.parse(t[e]);a.__id=e,n.push(a)}catch(c){}}),a.setState({viewGrid:e,gridResults:n})})},render:function(){var e,t=this;if(this.state.results.length>0){var a=null,n=this.state.results.every(function(e){return"string"==e.type});if(SearchStore.query.length>3&&n)var a=React.createElement("caption",{className:"actions"},React.createElement("div",{className:"viewgrid",onClick:this.toggleGridView},React.createElement("span",{className:"octicon octicon-list-unordered"}),React.createElement("b",null,this.state.viewGrid?"view summary":"view as grid")));var c=this.state.gridResults||[];if(this.state.viewGrid&&c.length>0){var s=Object.keys(c[0]).filter(function(e){return!e.startsWith("__")}),r=0;e=React.createElement("table",{className:"table table-striped table-wrap search-results"},a,React.createElement("thead",null,React.createElement("tr",null,s.map(function(e){return React.createElement("th",{key:e},e)}))),React.createElement("tbody",null,c.map(function(e){return React.createElement("tr",{key:e.__id,onClick:t.onKeyClick,"data-id":e.__id,"data-type":"string"},s.map(function(t){var a=e[t];return React.createElement("td",{key:r++},valueFmt(a))}))})))}else e=React.createElement("table",{className:"table table-striped table-wrap search-results"},a,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Key"),React.createElement("th",null,"Type"),React.createElement("th",null,"Size"),React.createElement("th",null,"Expires"))),React.createElement("tbody",null,this.state.results.map(function(e){return React.createElement("tr",{key:e.id,onClick:t.onKeyClick,"data-id":e.id,"data-type":e.type},React.createElement("td",null,e.id),React.createElement("td",null,e.type),React.createElement("td",null,e.size+("string"==e.type?" byte":" element")+(e.size>1?"s":"")),React.createElement("td",null,-1==e.ttl?"never":Math.round(e.ttl/1e3)+"s"))})))}else $("#txtSearch").val()&&(e=React.createElement("div",null,"Sorry No Results :("));return React.createElement("div",{id:"search-page"},React.createElement("div",{className:"content"},e))}}),Connections=React.createClass({displayName:"Connections",mixins:[Reflux.listenTo(ConnectionStore,"onConnection")],getInitialState:function(){return{connection:ConnectionStore.connection,successMessage:null}},componentDidMount:function(){this.refs.txtHost.getDOMNode().focus()},onConnection:function(e){this.setState({connection:e})},selectText:function(e){var t=e.target;setTimeout(function(){t.select()},0)},onChange:function(e){var t=this.state.connection||{};t[e.target.name]=e.target.value,this.setState({connection:t})},onSubmit:function(e){e.preventDefault(),this.setState({successMessage:null});var t=this;$(e.target).ajaxSubmit({onSubmitDisable:$("#btnConnect"),success:function(){t.setState({successMessage:"Connection was changed"}),Actions.loadConnection()}})},render:function(){var e=this.state.connection;return React.createElement("div",{id:"connections-page"},React.createElement("div",{className:"content"},React.createElement("form",{id:"formConnection",className:"form-inline",onSubmit:this.onSubmit,action:"/connection"},React.createElement("h2",null,"Redis Connection"),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"octicon octicon-radio-tower"}),React.createElement("input",{ref:"txtHost",id:"txtHost",name:"host",type:"text",className:"form-control",placeholder:"127.0.0.1",spellCheck:"false",onChange:this.onChange,onFocus:this.selectText,value:e?e.host:""}),React.createElement("label",null,":"),React.createElement("input",{id:"txtPort",name:"port",type:"text",className:"form-control",placeholder:"6379",spellCheck:"false",onChange:this.onChange,onFocus:this.selectText,value:e?e.port:""}),React.createElement("label",null,"db"),React.createElement("input",{id:"txtDb",name:"db",type:"text",className:"form-control",placeholder:"0",spellCheck:"false",onChange:this.onChange,onFocus:this.selectText,value:e?e.db:""})),React.createElement("p",{className:"actions"},React.createElement("img",{className:"loader",src:"/img/ajax-loader.gif"}),React.createElement("button",{id:"btnConnect",className:"btn btn-default btn-primary"},"Change Connection")),React.createElement("p",{className:"bg-success"},this.state.successMessage),React.createElement("p",{className:"bg-danger error-summary"}))))}}),Console=React.createClass({displayName:"Console",mixins:[Router.Navigation,Router.State,Reflux.listenTo(SettingsStore,"onSettingsUpdated"),Reflux.listenTo(ConsoleStore,"onConsoleChanged")],getInitialState:function(){return{expand:!1,command:ConsoleStore.command,history:ConsoleStore.history,historyIndex:ConsoleStore.historyIndex,logs:ConsoleStore.logs,appRawMode:SettingsStore.appRawMode,rawModes:{}}},componentWillMount:function(){var e=this.getQuery();this.setState({expand:"true"==e.expand})},componentDidMount:function(){this.getTextInput().focus()},onSettingsUpdated:function(e){this.setState({appRawMode:e.appRawMode,rawModes:{}})},onConsoleChanged:function(e){var t=this.getTextInput();this.setState(e,function(){t.focus()})},setCommand:function(e){var t=this.getTextInput();this.setState({command:e},function(){t.focus()})},clearLogs:function(){Actions.clearLogs(),this.refs.txtPrompt.getDOMNode().focus()},getTextInput:function(){var e=this.state.expand?this.refs.txtExpandedPrompt:this.refs.txtPrompt;return e.getDOMNode()},toggleExpand:function(){var e=this;this.setState({expand:!this.state.expand},function(){e.getTextInput().focus()})},toggleRawMode:function(e,t){if(!hasTextSelected()){if(this.state.rawModes[e]&&(t.shiftKey||t.ctrlKey))return void selectText(t.target);this.state.rawModes[e]=!this.state.rawModes[e],this.setState({rawModes:this.state.rawModes})}},renderResponse:function(e,t){if("string"==typeof e)return React.createElement("div",{className:"string"},this.renderValue(e,t));if(e.length){for(var a=this,n=[],c=0;c<e.length;c++)n.push(React.createElement("div",{key:c,className:"item"},a.renderValue(e[c],t)));return React.createElement("div",{className:"list"},n)}},renderValue:function(e,t){if("undefined"==typeof e&&(e=""),!isJsonObject(e))return React.createElement("div",null,e);if(t)return React.createElement("div",{className:"rawview"},e);try{var a=JSON.parse(e),n=React.createElement("div",{className:"jsonviewer",dangerouslySetInnerHTML:{__html:jsonviewer(a)}});return n}catch(c){return React.createElement("div",null,e)}},onSubmit:function(e){e.preventDefault();var t=this.state.command;if(t){Actions.addToHistory(t);Redis.execCommandString(t).then(function(e){var a=(JSON.stringify(e),"OK"===e?"ok":e?"msg":"empty");Actions.logEntry({cmd:t,result:e||"(empty)",type:a})}).fail(function(e,a,n){var c=$.ss.parseResponseStatus(e.responseText,n);Actions.logEntry({cmd:t,result:c.message,stackTrace:c.stackTrace,type:"err"})})}},onKeyDown:function(e){var t=e.which,a=[Keys.UP,Keys.DOWN];e.altKey||e.ctrlKey||-1==a.indexOf(t)||(t==Keys.UP?(Actions.nextHistory(-1),e.preventDefault()):t==Keys.DOWN&&Actions.nextHistory(1))},onChange:function(e){this.setState({command:e.target.value})},render:function(){var e=this,t=this.state.logs,a=null;t.length>0&&(a=React.createElement("div",{id:"btnClearHistory",onClick:this.clearLogs},React.createElement("span",{className:"octicon octicon-x"}),React.createElement("b",null,"clear")));var n,c=null;return this.state.expand?c=React.createElement("div",{id:"expandedPrompt"},React.createElement("div",{className:"collapse-console",title:"collapse"},React.createElement("span",{className:"octicon octicon-screen-normal",onClick:this.toggleExpand})),React.createElement("textarea",{ref:"txtExpandedPrompt",id:"txtExpandedPrompt",spellCheck:"false",autoComplete:"off",onChange:this.onChange,onKeyDown:this.onKeyDown,value:this.state.command})):n=React.createElement("div",{id:"prompt"},React.createElement("div",{className:"expand-console",title:"expand"},React.createElement("span",{className:"octicon octicon-screen-full",onClick:this.toggleExpand})),React.createElement("div",{id:"label"},React.createElement("span",{className:"octicon octicon-chevron-right"})),React.createElement("input",{ref:"txtPrompt",id:"txtPrompt",type:"text",className:"input-lg",placeholder:"Redis Commands e.g: GET key",spellCheck:"false",autoComplete:"off",onChange:this.onChange,onKeyDown:this.onKeyDown,value:this.state.command})),React.createElement("div",{id:"console-page"},React.createElement("div",{id:"console",className:"content"},React.createElement("div",{id:"log"},t.map(function(t){var a="entry";t.type&&(a+=" "+t.type);var n=e.state.appRawMode?!e.state.rawModes[t.id]:e.state.rawModes[t.id];return React.createElement("div",{key:t.id,className:a},React.createElement("div",{className:"cmd",onClick:e.setCommand.bind(e,t.cmd)},t.cmd),React.createElement("div",{className:"result",onClick:e.toggleRawMode.bind(e,t.id)},e.renderResponse(t.result,n),React.createElement("div",{className:"clear"})))})),React.createElement("div",{className:"actions"},a),React.createElement("form",{id:"formConsole",onSubmit:this.onSubmit},n)),c)}}),App=React.createClass({displayName:"App",mixins:[DebugLogMixin,Router.Navigation,Router.State,Reflux.listenTo(SearchStore,"onSearchUpdated"),Reflux.listenTo(ConnectionStore,"onConnection")],getInitialState:function(){return{connection:null,query:this.getQuery().q}},onConnection:function(e){this.setState({connection:e})},onSearchUpdated:function(e){e.text!=this.state.query&&this.setState({query:e.text})},onSearchFocus:function(e){this.transitionTo("search",null,{q:e.target.value})},onSearchKeyUp:function(e){e.target.value!=this.state.query&&(this.setState({query:e.target.value}),this.replaceWith("search",null,{q:e.target.value}))},clearSearch:function(){this.refs.txtSearch.getDOMNode().focus(),this.replaceWith("search",null,{q:null})},render:function(){var e=React.createElement("b",null,"not connected"),t=this.state.connection;null!=t&&(e=React.createElement("b",null,t.host,":",t.port," db=",t.db));var a=null;return this.state.query&&(a=React.createElement("div",{className:"clear-search"},React.createElement("span",{className:"octicon octicon-x",onClick:this.clearSearch,title:"clear search"}))),React.createElement("div",null,React.createElement("nav",{className:"navbar navbar-default navbar-fixed-top"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement(Link,{to:"app",title:"Home",className:"navbar-brand"},React.createElement("img",{id:"redislogo",alt:"Brand",src:"/img/redis-logo.png"})),React.createElement("h1",null,"Redis React"),React.createElement(Link,{id:"connection",to:"connections",title:"Connections"},React.createElement("span",{className:"octicon octicon-radio-tower"}),e)),React.createElement("form",{id:"formSearch",className:"navbar-form navbar-left",role:"search"},React.createElement("div",null,a,React.createElement("span",{className:"octicon octicon-search"}),React.createElement("input",{ref:"txtSearch",id:"txtSearch",type:"text",className:"input-lg",placeholder:"Search Keys",spellCheck:"false",autoComplete:"off",onFocus:this.onSearchFocus,onChange:this.onSearchKeyUp,value:this.state.query}))),React.createElement("div",{className:"nav navbar-nav navbar-right"},React.createElement("a",{href:"https://servicestack.net",title:"servicestack.net",target:"_blank"},React.createElement("img",{id:"logo",alt:"Brand",src:"/img/logo-32.png"}))))),React.createElement("div",null,React.createElement("div",{id:"sidebar"},React.createElement("ul",{id:"menu"},React.createElement("li",{className:"list-group-item"},React.createElement(Link,{to:"console",title:"Console"},React.createElement("span",{className:"mega-octicon octicon-terminal"}))))),React.createElement("div",{id:"body"},React.createElement(RouteHandler,null))),React.createElement("div",{id:"poweredby"},React.createElement("a",{href:"https://servicestack.net",target:"_blank"},"servicestack.net")))}}),routes=React.createElement(Route,{name:"app",path:"/",handler:App},React.createElement(Route,{name:"connections",handler:Connections}),React.createElement(Route,{name:"search",handler:Search}),React.createElement(Route,{name:"keys",handler:KeyViewer}),React.createElement(Route,{name:"console",handler:Console}),React.createElement(DefaultRoute,{handler:Dashboard}));Router.run(routes,function(e,t){React.render(React.createElement(e,null),document.body);var a=t.pathname.substring(1);document.body.className=(a||"home")+"-active"}),Actions.viewInfo(),Actions.loadConnection();